<style>
    #HasPermission > strong, #NoPermission > strong {
        margin: -3px 10px 0 2px;
    }
</style>

<h3 class="col-md-3">
  Add Permission
</h3>

<div class="col-md-9" style="text-align: right;">
  <button class="btn btn-primary SavePermissions" style="width: 200px;margin: 10px 0 0 0;">保存</button>
</div>
<!--
<% @permissions.each_with_index do |p, index| %>
    <tr>
      <td><%= index+1 %>
      <td><%= p[:name] %></td>
      <td><%= p[:status] %></td>
    </tr>
<% end %>
-->

<table class="table table-bordered">
  <thead>
  <tr>
    <th>状态</th>
    <th>Permissions</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td style="width: 200px;"><strong>已拥有权限</strong></td>
    <td id="HasPermission"></td>
  </tr>
  <tr>
    <td style="width: 200px;"><strong>未拥有权限</strong></td>
    <td id="NoPermission"></td>
  </tr>
  </tbody>
</table>

<script>
    ShowPermission();

    var PermissionJSON = [];
    $('.SavePermissions').click(function () {
        $('.CheckBox').each(function () {
            var PerssionsID = $(this).attr('id');
            var PerssionsName = $(this).parent().children('strong').html();
            var PerssionsStatus = $(this).attr('ischecked');
            PermissionJSON.push({id: PerssionsID, name: PerssionsName, status: PerssionsStatus});
        });

        $.ajax({
            url: '/permission_groups/add_permissions',
            type: 'post',
            data: {
                PermissionGroupID: <%=@permission_group.id %>,
                PermissionData: PermissionJSON
            },
            success: function (data) {
            },
            error: function () {
            }
        });
    });

    function ShowPermission() {
        <% @permissions.each_with_index do |p, index| %>
        if (<%= p[:status] %>) {
            $('<div class="col-md-1" style="white-space: nowrap;text-overflow: ellipsis;overflow: hidden;">' +
                    '<input type="checkbox" class="CheckBox" id="<%= p[:id]%>" ischecked="true"><strong title="<%= p[:name] %>">' + '<%= p[:name] %>' + '</strong></input></div>').appendTo('#HasPermission').ready(function () {
            });
        } else {
            $('<div class="col-md-1" style="white-space: nowrap;text-overflow: ellipsis;overflow: hidden;">' +
                    '<input type="checkbox" class="CheckBox" id="<%= p[:id]%>" ischecked="false"> <strong title="<%= p[:name] %>">' + '<%= p[:name] %>' + '</strong></input></div>').appendTo('#NoPermission').ready(function () {
            });
        }
        <% end %>

        $(":checkbox").click(function () {
            if ($(this).attr('ischecked') == "true") {
                $(this).attr('ischecked', 'false');
            } else {
                $(this).attr('ischecked', 'true');
            }
        });
    }
</script>