<div class="panel panel-warning">
  <div class="panel-heading">
    <h2>收货差异报表报表</h2>
    包括收货总量,实际接收量,以及拒收总量
  </div>
  <div class="panel-body">
    <br/>
    <div>
      <script type="text/javascript">
          $(function () {
              data_upload("#item-data-uploader", false, function (data) {
                  if (data.result) {
                      $("#file").val(JSON.stringify(data.content));
                      $("#item-data-uploader-preview > span[info]").html("文件上传成功");
                  } else {
                      $("#file").val('');
                  }
              });
          });
          function submitForm() {
              if ($("#file").val().length > 0)
                  document.forms[0].submit();
              else
                  alert('请上传文件');
          }
      </script>
      <div>
        <span>上传报表：</span>
        <input id="item-data-uploader" type="file" name="files[]" data-url="/reports/upload_file">
        <div class="abstractblock" id="item-data-uploader-preview" style="display:none;"></div>
      </div>
    </div>
    <div>
      <form method="get" action="<%= reports_entry_discrepancy_path %>">
          <div>
            <span>地点:
              <%= select_tag(:location_id, options_for_select(Location.list_menu, @location_id), include_blank: false) %>
            </span>
            <span>时间范围:
              <input type="text" name="received_date_start" class="datepicker" value="<%= @received_date_start %>"/>
              ~ <input type="text" name="received_date_end" class="datepicker" value="<%= @received_date_end %>"/>
            </span>
            <span>查看类型：
              <%= select_tag :format, options_for_select([["查找", "html"],["导出xlsx", "xlsx"]], "html") %>
            </span>
            <input type="hidden" id="file" name="file">
            <input type="submit" value="确定" class="btn btn-warning" name="commit"/>
          </div>
      </form>
    </div>
  </div>
  <br/>
  <table class="table table-striped table-condensed table-hover">
    <thead>
    <tr>
      <th>编号</th>
      <th>零件号</th>
      <th>部门</th>
      <th>报表数量</th>
      <th>系统数量</th>
      <th>差异值</th>
    </tr>
    </thead>
    <tbody>
    <% @packages.each_with_index do |p,index| %>
    <tr>
      <td><%= index+1%></td>
      <td><%= p.part_id %></td>
      <td><%= p.whouse_id %></td>
      <td><%= @result[p.part_id+p.whouse_id] %></td>
      <td><%= p.total %></td>
      <td><%= @result[p.part_id+p.whouse_id].nil? ? p.total : p.total-@result[p.part_id+p.whouse_id] %></td>
    </tr>
    <% end %>
    </tbody>
  </table>
</div>

<%%>

<script>
    $(function () {
        $(".datepicker").datetimepicker({
            lang: 'ch',
            format: 'Y-m-d H:i'
        });
    });
    init_check();
</script>
