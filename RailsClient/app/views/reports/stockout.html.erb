<div class="panel panel-warning">
  <div class="panel-heading" style="display: flex;">
    <h3>缺货报表</h3>
    <h5 style="margin-top: 25px;margin-left: 20px;">缺货统计报表.</h5>
  </div>
</div>

<form method="get" path="<%= reports_stockout_path %>">
  <div class="panel-body">
    <div class="col-sm-12" style="border-bottom: 1px dashed #000;margin-top: -20px;height: 40px;">
      <div class="col-sm-2">
        零件号：
        <input type="text" name="part_id" value="<%= @part_id %>"/>
      </div>
      <div class="col-sm-6">
        <span class="label label-info">缺货时间:</span>
        <input id="date-start" type="text" name="date_start" class="datepicker" value="<%= @date_start %>"/>
        ~ <input id="date-end" type="text" name="date_end" class="datepicker" value="<%= @date_end %>"/>
      </div>

      <div class="col-sm-2">
        <span class="label label-info">显示方式:</span>
        <%= select_tag :format, options_for_select([["Web", "html"], ["Excel File(MS 07 or later)", "xlsx"]], "html") %>
      </div>
      <div class="col-sm-2">
        <input type="submit" style="width: 150px;" value="查找" class="btn btn-warning" name="commit" onclick="submitForm()"/>
      </div>
    </div>

  </div>
</form>

<table class="table table-striped table-bordered table-hover">
  <thead>
  <tr>
    <th>NO.</th>
    <th>零件号</th>
    <th>需求数量</th>
    <th>发货数量</th>
    <th>缺货数量</th>
    <th>现有库存数量</th>
  </tr>
  </thead>
  <% if @items.present? %>
      <tbody>
      <% @items.keys.each_with_index do |key, i| %>
          <% if @items[key][:order_count].to_i<=@items[key][:send_count].to_i %>
          <% next %>
          <% end %>
          <tr>
            <td><%= i+1 %></td>
            <td>
              <% if part=Part.find_by_id(key) %>
                  <%= part.nr %>
              <% else %>
                  <%= key %>
              <% end %>
            </td>
            <td><%= @items[key][:order_count].to_i %></td>
            <td><%= @items[key][:send_count].to_i %></td>
            <td><%= @items[key][:order_count].to_i-@items[key][:send_count].to_i %></td>
            <td><%= @items[key][:stock_count].to_i %></td>
          </tr>
      <% end %>
      </tbody>
  <% end %>
</table>

<script>
    $(document).ready(function () {
        $(".datepicker").datetimepicker({
            lang: 'ch',
            format: 'Y-m-d H:i'
        });

        $('.selectpicker').selectpicker();
        $('.selectpicker').selectpicker('val', 'Mustard');
        $('.selectpicker').selectpicker('render');
    });
</script>